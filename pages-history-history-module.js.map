{"version":3,"sources":["webpack:///./src/app/pages/history/history.module.ts","webpack:///./src/app/pages/history/history.page.html","webpack:///./src/app/pages/history/history.page.scss","webpack:///./src/app/pages/history/history.page.ts"],"names":[],"mappings":"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","file":"pages-history-history-module.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { HistoryPage } from './history.page';\nimport { SharedModule } from '../../shared.module';\n\nconst routes: Routes = [\n\t{\n\t\tpath: '',\n\t\tcomponent: HistoryPage\n\t}\n];\n\n@NgModule({\n\timports: [\n\t\tSharedModule,\n\t\tRouterModule.forChild(routes)\n\t],\n\tdeclarations: [HistoryPage]\n})\nexport class HistoryPageModule {\n}\n","module.exports = \"<ion-header>\\n  <ion-toolbar>\\n    <ion-buttons slot=\\\"start\\\">\\n      <ion-menu-button></ion-menu-button>\\n    </ion-buttons>\\n\\n\\n    <ion-title>\\n      History\\n      <span *ngIf=\\\"history?.length > 0\\\">({{ history.length }}шт.)</span>\\n    </ion-title>\\n  </ion-toolbar>\\n</ion-header>\\n\\n\\n<ion-content>\\n  <div *ngIf=\\\"!loading\\\">\\n    <div *ngIf=\\\"history?.length > 0\\\">\\n      <div @list id=\\\"cards\\\">\\n        <app-queue-video\\n                @items\\n                *ngFor=\\\"let item of history; trackBy: trackQueue\\\"\\n                [queueItem]=\\\"item\\\"\\n                [isHistory]=\\\"true\\\">\\n        </app-queue-video>\\n      </div>\\n\\n      <ion-infinite-scroll threshold=\\\"5px\\\" (ionInfinite)=\\\"onInfiniteScroll($event)\\\">\\n        <ion-infinite-scroll-content\\n                loadingSpinner=\\\"bubbles\\\"\\n                loadingText=\\\"Loading more data...\\\">\\n        </ion-infinite-scroll-content>\\n      </ion-infinite-scroll>\\n    </div>\\n\\n\\n    <h2 *ngIf=\\\"history?.length === 0\\\" text-center>empty</h2>\\n  </div>\\n\\n  <ion-row *ngIf=\\\"loading\\\" justify-content-center>\\n    <ion-spinner name=\\\"dots\\\"></ion-spinner>\\n  </ion-row>\\n</ion-content>\\n\"","module.exports = \"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJzcmMvYXBwL3BhZ2VzL2hpc3RvcnkvaGlzdG9yeS5wYWdlLnNjc3MifQ== */\"","import { Component, ElementRef, OnInit } from '@angular/core';\nimport { QueryDocumentSnapshot } from '@angular/fire/firestore';\n\nimport { HistoryService, IHistoryItem } from '../../services/history.service';\nimport { IQueueItem } from '../../services/queues.service';\nimport { animate, animateChild, query, stagger, style, transition, trigger } from '@angular/animations';\n\n@Component({\n\tselector: 'app-history',\n\ttemplateUrl: './history.page.html',\n\tstyleUrls: ['./history.page.scss'],\n\tanimations: [\n\t\t// nice stagger effect when showing existing elements\n\t\ttrigger('list', [\n\t\t\ttransition(':enter', [\n\t\t\t\t// child animation selector + stagger\n\t\t\t\tquery('@items',\n\t\t\t\t\tstagger(300, animateChild())\n\t\t\t\t)\n\t\t\t]),\n\t\t]),\n\t\ttrigger('items', [\n\t\t\t// cubic-bezier for a tiny bouncing feel\n\t\t\ttransition(':enter', [\n\t\t\t\tstyle({ transform: 'scale(0.5)', opacity: 0 }),\n\t\t\t\tanimate('1s cubic-bezier(.8,-0.6,0.2,1.5)',\n\t\t\t\t\tstyle({ transform: 'scale(1)', opacity: 1 }))\n\t\t\t]),\n\t\t\ttransition(':leave', [\n\t\t\t\tstyle({ transform: 'scale(1)', opacity: 1, height: '*' }),\n\t\t\t\tanimate('1s cubic-bezier(.8,-0.6,0.2,1.5)',\n\t\t\t\t\tstyle({ transform: 'scale(0.5)', opacity: 0, height: '0px', margin: '0px' }))\n\t\t\t]),\n\t\t])\n\t]\n})\nexport class HistoryPage implements OnInit {\n\tloading = true;\n\tlimit = 2;\n\thistory: IHistoryItem[];\n\thistorySnapshot: QueryDocumentSnapshot<IHistoryItem>[];\n\n\tconstructor(\n\t\tprivate historyService: HistoryService,\n\t\tprivate r: ElementRef,\n\t) {\n\t}\n\n\tngOnInit(): void {\n\t\tthis.initLoad();\n\n\n\t\tthis.historyService\n\t\t\t.getHistorySub(this.limit)\n\t\t\t.subscribe((e: IHistoryItem[]) => {\n\t\t\t\tthis.checkInitHeight();\n\t\t\t});\n\t}\n\n\tasync initLoad(): Promise<void> {\n\t\tconst docs: QueryDocumentSnapshot<any>[] = (await this.historyService\n\t\t\t.getHistoryList(this.limit)\n\t\t\t.toPromise())\n\t\t\t.docs;\n\n\t\tthis.historySnapshot = docs;\n\t\tthis.history = docs.map(item => item.data());\n\t\tthis.loading = false;\n\t}\n\n\tcheckInitHeight(): void {\n\t\tsetTimeout(() => {\n\t\t\tconst cards = this.r.nativeElement.querySelector('#cards');\n\n\t\t\tif (cards) {\n\t\t\t\tconst wp = cards.closest('ion-content');\n\n\t\t\t\tif (cards && cards.clientHeight < wp.clientHeight) {\n\t\t\t\t\t// if cards height less than screen we need to load more\n\t\t\t\t\tthis.loadMore();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// in case if we have no cards but just added one more\n\t\t\t\tthis.initLoad();\n\t\t\t}\n\t\t});\n\t}\n\n\tasync loadMore(): Promise<void> {\n\t\tconst lastSnapshot = this.historySnapshot[this.historySnapshot.length - 1];\n\n\t\tif (lastSnapshot) {\n\t\t\tconst docs: QueryDocumentSnapshot<any>[] = (await this.historyService\n\t\t\t\t.getHistoryFromTo(lastSnapshot, this.limit)\n\t\t\t\t.toPromise())\n\t\t\t\t.docs;\n\n\t\t\tthis.historySnapshot = docs ? this.historySnapshot.concat(...docs) : null;\n\t\t\tthis.history = docs ? this.history.concat(...docs.map(item => item.data())) : null;\n\t\t}\n\t}\n\n\tonInfiniteScroll(event): void {\n\t\tsetTimeout(() => {\n\t\t\tthis.loadMore();\n\n\t\t\tevent.target.complete();\n\t\t}, 500);\n\t}\n\n\ttrackQueue(index, queue: IQueueItem) {\n\t\treturn queue ? queue.id : undefined;\n\t}\n}\n"],"sourceRoot":""}