{"version":3,"sources":["webpack:///./src/app/pages/history/history.module.ts","webpack:///./src/app/pages/history/history.page.html","webpack:///./src/app/pages/history/history.page.scss","webpack:///./src/app/pages/history/history.page.ts"],"names":[],"mappings":"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","file":"pages-history-history-module.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { HistoryPage } from './history.page';\r\nimport { SharedModule } from '../../shared.module';\r\n\r\nconst routes: Routes = [\r\n\t{\r\n\t\tpath: '',\r\n\t\tcomponent: HistoryPage\r\n\t}\r\n];\r\n\r\n@NgModule({\r\n\timports: [\r\n\t\tSharedModule,\r\n\t\tRouterModule.forChild(routes)\r\n\t],\r\n\tdeclarations: [HistoryPage]\r\n})\r\nexport class HistoryPageModule {\r\n}\r\n","module.exports = \"<ion-header>\\r\\n  <ion-toolbar>\\r\\n    <ion-buttons slot=\\\"start\\\">\\r\\n      <ion-menu-button></ion-menu-button>\\r\\n    </ion-buttons>\\r\\n\\r\\n\\r\\n    <ion-title>\\r\\n      История\\r\\n      <span *ngIf=\\\"historyLen\\\">({{ historyLen }}шт.)</span>\\r\\n    </ion-title>\\r\\n  </ion-toolbar>\\r\\n</ion-header>\\r\\n\\r\\n\\r\\n<ion-content>\\r\\n  <ion-refresher (ionRefresh)=\\\"onRefresh($event)\\\">\\r\\n    <ion-refresher-content></ion-refresher-content>\\r\\n  </ion-refresher>\\r\\n\\r\\n\\r\\n  <div *ngIf=\\\"history?.length > 0\\\">\\r\\n    <div id=\\\"cards\\\">\\r\\n      <app-queue-video\\r\\n              *ngFor=\\\"let item of history; trackBy: trackQueue\\\"\\r\\n              [queueItem]=\\\"item\\\"\\r\\n              [isHistory]=\\\"true\\\">\\r\\n      </app-queue-video>\\r\\n    </div>\\r\\n\\r\\n    <ion-infinite-scroll threshold=\\\"5px\\\" (ionInfinite)=\\\"onInfiniteScroll($event)\\\">\\r\\n      <ion-infinite-scroll-content\\r\\n              loadingSpinner=\\\"bubbles\\\"\\r\\n              loadingText=\\\"Loading more data...\\\">\\r\\n      </ion-infinite-scroll-content>\\r\\n    </ion-infinite-scroll>\\r\\n  </div>\\r\\n\\r\\n\\r\\n  <h2 *ngIf=\\\"history?.length === 0\\\" text-center>Пустовато</h2>\\r\\n</ion-content>\\r\\n\"","module.exports = \"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJzcmMvYXBwL3BhZ2VzL2hpc3RvcnkvaGlzdG9yeS5wYWdlLnNjc3MifQ== */\"","import { Component, ElementRef, OnInit } from '@angular/core';\r\nimport { QueryDocumentSnapshot } from '@angular/fire/firestore';\r\n\r\nimport { HistoryService, IHistoryItem } from '../../services/history.service';\r\nimport { IQueueItem } from '../../services/queues.service';\r\n\r\n@Component({\r\n\tselector: 'app-history',\r\n\ttemplateUrl: './history.page.html',\r\n\tstyleUrls: ['./history.page.scss'],\r\n})\r\nexport class HistoryPage implements OnInit {\r\n\thistoryLen: number;\r\n\tlimit = 2;\r\n\thistory: IHistoryItem[];\r\n\thistorySnapshot: QueryDocumentSnapshot<IHistoryItem>[];\r\n\tprivate cardsHeightIsChecked = false;\r\n\r\n\tconstructor(\r\n\t\tprivate historyService: HistoryService,\r\n\t\tprivate r: ElementRef,\r\n\t) {\r\n\t}\r\n\r\n\tasync ngOnInit(): Promise<void> {\r\n\t\tconst docs: QueryDocumentSnapshot<any>[] = (await this.historyService\r\n\t\t\t.getHistory(this.limit)\r\n\t\t\t.toPromise())\r\n\t\t\t.docs;\r\n\r\n\t\tthis.historySnapshot = docs;\r\n\t\tthis.history = docs.map(item => item.data());\r\n\r\n\t\tthis.checkInitHeight();\r\n\t}\r\n\r\n\tcheckInitHeight(): void {\r\n\t\tsetTimeout(() => {\r\n\t\t\tconst cards = this.r.nativeElement.querySelector('#cards');\r\n\r\n\t\t\tif (cards) {\r\n\t\t\t\tconst wp = cards.closest('ion-content');\r\n\r\n\t\t\t\tif (cards && cards.clientHeight < wp.clientHeight) {\r\n\t\t\t\t\t// if cards height less than screen we need to load more\r\n\t\t\t\t\tthis.loadMore();\r\n\t\t\t\t\tthis.cardsHeightIsChecked = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tasync loadMore(): Promise<void> {\r\n\t\tconst lastSnapshot = this.historySnapshot[this.historySnapshot.length - 1];\r\n\r\n\t\tif (lastSnapshot) {\r\n\t\t\tconst docs: QueryDocumentSnapshot<any>[] = (await this.historyService\r\n\t\t\t\t.getHistoryFromTo(lastSnapshot, this.limit)\r\n\t\t\t\t.toPromise())\r\n\t\t\t\t.docs;\r\n\r\n\t\t\tthis.historySnapshot = docs ? this.historySnapshot.concat(...docs) : null;\r\n\t\t\tthis.history = docs ? this.history.concat(...docs.map(item => item.data())) : null;\r\n\t\t}\r\n\t}\r\n\r\n\tasync onRefresh(event): Promise<void> {\r\n\t\tconst fromFirstSnapshot = this.historySnapshot[0];\r\n\r\n\t\tif (fromFirstSnapshot) {\r\n\t\t\tconst toVisibleLength = this.historySnapshot.length;\r\n\r\n\t\t\tconst docs: QueryDocumentSnapshot<any>[] = (await this.historyService\r\n\t\t\t\t.getHistoryFromTo(fromFirstSnapshot, toVisibleLength, true)\r\n\t\t\t\t.toPromise())\r\n\t\t\t\t.docs;\r\n\r\n\t\t\tthis.historySnapshot = docs;\r\n\t\t\tthis.history = docs.map(item => item.data());\r\n\t\t}\r\n\r\n\t\tevent.target.complete();\r\n\t}\r\n\r\n\tonInfiniteScroll(event): void {\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.loadMore();\r\n\r\n\t\t\tevent.target.complete();\r\n\t\t}, 500);\r\n\t}\r\n\r\n\ttrackQueue(index, queue: IQueueItem) {\r\n\t\treturn queue ? queue.key : undefined;\r\n\t}\r\n}\r\n"],"sourceRoot":""}