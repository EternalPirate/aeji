{"version":3,"sources":["webpack:///./src/app/pages/queue/queue.module.ts","webpack:///./src/app/pages/queue/queue.page.html","webpack:///./src/app/pages/queue/queue.page.scss","webpack:///./src/app/pages/queue/queue.page.ts"],"names":[],"mappings":"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","file":"pages-queue-queue-module.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { QueuePage } from './queue.page';\r\nimport { SharedModule } from '../../shared.module';\r\n\r\nconst routes: Routes = [\r\n\t{\r\n\t\tpath: '',\r\n\t\tcomponent: QueuePage\r\n\t}\r\n];\r\n\r\n@NgModule({\r\n\timports: [\r\n\t\tSharedModule,\r\n\t\tRouterModule.forChild(routes)\r\n\t],\r\n\tdeclarations: [QueuePage]\r\n})\r\nexport class QueuePageModule {\r\n}\r\n","module.exports = \"<ion-header>\\r\\n    <ion-toolbar>\\r\\n        <ion-buttons slot=\\\"start\\\">\\r\\n            <ion-back-button></ion-back-button>\\r\\n        </ion-buttons>\\r\\n\\r\\n        <ion-title *ngIf=\\\"activeQueue\\\">\\r\\n            {{ activeQueue.queueType }}\\r\\n            Очередь\\r\\n            <span *ngIf=\\\"activeQueue.videoQueueLen\\\">({{ activeQueue.videoQueueLen }}шт.)</span>\\r\\n        </ion-title>\\r\\n    </ion-toolbar>\\r\\n</ion-header>\\r\\n\\r\\n\\r\\n<ion-content>\\r\\n    <div *ngIf=\\\"loaded\\\">\\r\\n        <div *ngIf=\\\"queue?.length > 0\\\">\\r\\n            <div @list id=\\\"cards\\\">\\r\\n                <app-queue-video\\r\\n                        @items\\r\\n                        *ngFor=\\\"let queueItem of queue; let last = last; let index = index; trackBy: trackQueue\\\"\\r\\n                        [queueItem]=\\\"queueItem\\\"\\r\\n                        [last]=\\\"last\\\"\\r\\n                        [index]=\\\"index\\\"\\r\\n                        (removeItem)=\\\"removeItem($event)\\\"\\r\\n                        (lastVideoLoad)=\\\"onLastVideoLoad()\\\">\\r\\n                </app-queue-video>\\r\\n            </div>\\r\\n\\r\\n\\r\\n            <ion-infinite-scroll threshold=\\\"5px\\\" (ionInfinite)=\\\"onInfiniteScroll($event)\\\">\\r\\n                <ion-infinite-scroll-content\\r\\n                        loadingSpinner=\\\"bubbles\\\"\\r\\n                        loadingText=\\\"Loading more data...\\\">\\r\\n                </ion-infinite-scroll-content>\\r\\n            </ion-infinite-scroll>\\r\\n        </div>\\r\\n\\r\\n        <h2 *ngIf=\\\"queue?.length === 0\\\" text-center>Пустовато</h2>\\r\\n    </div>\\r\\n\\r\\n\\r\\n    <h2 *ngIf=\\\"!loaded\\\" text-center>\\r\\n        ...загрузка\\r\\n    </h2>\\r\\n</ion-content>\\r\\n\"","module.exports = \"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJzcmMvYXBwL3BhZ2VzL3F1ZXVlL3F1ZXVlLnBhZ2Uuc2NzcyJ9 */\"","import { Component, ElementRef, OnInit, ViewChild } from '@angular/core';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { DomSanitizer } from '@angular/platform-browser';\r\nimport { ActionSheetController } from '@ionic/angular';\r\nimport { QueryDocumentSnapshot } from '@angular/fire/firestore';\r\nimport { trigger, transition, style, animate, query, stagger, animateChild } from '@angular/animations';\r\nimport * as firebase from 'firebase/app';\r\n\r\nimport { QueuesService, IQueueItem, IQueuesResponse } from '../../services/queues.service';\r\nimport { HistoryService, IHistoryItem } from '../../services/history.service';\r\nimport { IRemoveQueueItemEvent } from '../../components/queue-video/queue-video.component';\r\n\r\n@Component({\r\n\tselector: 'app-queue-list',\r\n\ttemplateUrl: './queue.page.html',\r\n\tstyleUrls: ['./queue.page.scss'],\r\n\tanimations: [\r\n\t\t// nice stagger effect when showing existing elements\r\n\t\ttrigger('list', [\r\n\t\t\ttransition(':enter', [\r\n\t\t\t\t// child animation selector + stagger\r\n\t\t\t\tquery('@items',\r\n\t\t\t\t\tstagger(300, animateChild())\r\n\t\t\t\t)\r\n\t\t\t]),\r\n\t\t]),\r\n\t\ttrigger('items', [\r\n\t\t\t// cubic-bezier for a tiny bouncing feel\r\n\t\t\ttransition(':enter', [\r\n\t\t\t\tstyle({ transform: 'scale(0.5)', opacity: 0 }),\r\n\t\t\t\tanimate('1s cubic-bezier(.8,-0.6,0.2,1.5)',\r\n\t\t\t\t\tstyle({ transform: 'scale(1)', opacity: 1 }))\r\n\t\t\t]),\r\n\t\t\ttransition(':leave', [\r\n\t\t\t\tstyle({ transform: 'scale(1)', opacity: 1, height: '*' }),\r\n\t\t\t\tanimate('1s cubic-bezier(.8,-0.6,0.2,1.5)',\r\n\t\t\t\t\tstyle({ transform: 'scale(0.5)', opacity: 0, height: '0px', margin: '0px' }))\r\n\t\t\t]),\r\n\t\t])\r\n\t]\r\n})\r\nexport class QueuePage implements OnInit {\r\n\tactiveQueue: IQueuesResponse = {\r\n\t\tqueueType: null,\r\n\t\tvideoQueueLen: null\r\n\t};\r\n\tlimit = 2;\r\n\tqueue: IQueueItem[];\r\n\tqueueSnapshot: QueryDocumentSnapshot<IQueueItem>[];\r\n\tloaded = false;\r\n\tprivate cardsHeightIsChecked = false;\r\n\r\n\tconstructor(\r\n\t\tprivate queuesService: QueuesService,\r\n\t\tprivate historyService: HistoryService,\r\n\t\tprivate sanitizer: DomSanitizer,\r\n\t\tprivate router: Router,\r\n\t\tprivate route: ActivatedRoute,\r\n\t\tprivate r: ElementRef,\r\n\t\tprivate actionSheetController: ActionSheetController\r\n\t) {\r\n\t}\r\n\r\n\tngOnInit(): void {\r\n\t\tthis.activeQueue.queueType = this.route.snapshot.params.id;\r\n\r\n\t\tif (this.activeQueue.queueType) {\r\n\t\t\tthis.initLoad();\r\n\r\n\t\t\t// check for queue change\r\n\t\t\tthis.queuesService\r\n\t\t\t\t.getQueueByIdSub(this.activeQueue.queueType, this.limit)\r\n\t\t\t\t.subscribe((activeQueue: IQueuesResponse) => {\r\n\t\t\t\tthis.activeQueue = activeQueue;\r\n\t\t\t\tthis.checkInitHeight();\r\n\t\t\t});\r\n\r\n\t\t\tthis.loaded = true;\r\n\t\t}\r\n\t}\r\n\r\n\tasync initLoad(): Promise<void> {\r\n\t\tconst collection = this.queuesService.getQueueListById(this.activeQueue.queueType, this.limit);\r\n\t\tconst docs: QueryDocumentSnapshot<any>[] = (await collection.toPromise()).docs;\r\n\r\n\t\t// get snapshot and values\r\n\t\t// snapshot need for lazyloading and removing items\r\n\t\tthis.queueSnapshot = docs;\r\n\t\tthis.queue = docs.map(item => item.data());\r\n\t}\r\n\r\n\tasync removeItem(e: IRemoveQueueItemEvent): Promise<void> {\r\n\t\tconst remEl = e.event.target as HTMLElement;\r\n\t\tremEl.classList.add('on-removing');\r\n\r\n\t\tconst actionSheet = await this.actionSheetController.create({\r\n\t\t\theader: 'Точно удалить?',\r\n\t\t\tbuttons: [{\r\n\t\t\t\ttext: 'Да',\r\n\t\t\t\trole: 'destructive',\r\n\t\t\t\ticon: 'trash',\r\n\t\t\t\thandler: () => {\r\n\t\t\t\t\tconst removedSnapshot = this.queueSnapshot.splice(e.index, 1)[0];\r\n\t\t\t\t\tconst removed: IHistoryItem = {\r\n\t\t\t\t\t\t...this.queue.splice(e.index, 1)[0],\r\n\t\t\t\t\t\tdate_removed: firebase.firestore.FieldValue.serverTimestamp()\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tthis.historyService.pushToHistory(removed);\r\n\t\t\t\t\tthis.queuesService.deleteQueueItem(this.activeQueue.queueType, removedSnapshot);\r\n\r\n\t\t\t\t\tremEl.classList.remove('on-removing');\r\n\t\t\t\t}\r\n\t\t\t}, {\r\n\t\t\t\ttext: 'Отмена',\r\n\t\t\t\ticon: 'close',\r\n\t\t\t\trole: 'cancel',\r\n\t\t\t\thandler: () => {\r\n\t\t\t\t\tremEl.classList.remove('on-removing');\r\n\t\t\t\t}\r\n\t\t\t}]\r\n\t\t});\r\n\t\tawait actionSheet.present();\r\n\t}\r\n\r\n\tonLastVideoLoad(): void {\r\n\t\t// onLastVideoLoad need to checkInitHeight\r\n\t\tif (!this.cardsHeightIsChecked) {\r\n\t\t\tthis.checkInitHeight();\r\n\t\t}\r\n\t}\r\n\r\n\tcheckInitHeight(): void {\r\n\t\tsetTimeout(() => {\r\n\t\t\tconst cards = this.r.nativeElement.querySelector('#cards');\r\n\r\n\t\t\tif (cards) {\r\n\t\t\t\tconst wp = cards.closest('ion-content');\r\n\r\n\t\t\t\tif (cards && cards.clientHeight < wp.clientHeight) {\r\n\t\t\t\t\t// if cards height less than screen we need to load more\r\n\t\t\t\t\tthis.loadMore();\r\n\t\t\t\t\tthis.cardsHeightIsChecked = true;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// in case if we have no cards but just added one more\r\n\t\t\t\tthis.initLoad();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tasync loadMore(): Promise<void> {\r\n\t\tconst lastSnapshot = this.queueSnapshot[this.queueSnapshot.length - 1];\r\n\r\n\t\tif (lastSnapshot) {\r\n\t\t\tconst docs: QueryDocumentSnapshot<any>[] = (await this.queuesService\r\n\t\t\t\t.getQueueByIdFromTo(this.activeQueue.queueType, lastSnapshot, this.limit)\r\n\t\t\t\t.toPromise())\r\n\t\t\t\t.docs;\r\n\r\n\t\t\tif (docs.length > 0) {\r\n\t\t\t\tthis.queueSnapshot = this.queueSnapshot.concat(...docs);\r\n\t\t\t\tthis.queue = this.queue.concat(...docs.map(item => item.data()));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tonInfiniteScroll(event): void {\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.loadMore();\r\n\r\n\t\t\tevent.target.complete();\r\n\t\t}, 500);\r\n\t}\r\n\r\n\ttrackQueue(index, queue: IQueueItem) {\r\n\t\treturn queue ? queue.id : undefined;\r\n\t}\r\n}\r\n"],"sourceRoot":""}